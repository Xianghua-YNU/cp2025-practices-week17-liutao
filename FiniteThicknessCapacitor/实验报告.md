# 项目：有限厚平行板电容器电荷分布分析 - 实验报告

**学生姓名：** [赖株涛] **学号：** [20231050070] **完成日期：** [2025/6/18]

## 1. 实验目的

[本实验的学习目标是掌握使用高斯 - 赛德尔超松弛（SOR）方法求解二维拉普拉斯方程，并学会计算电荷密度分布和进行结果可视化。要解决的物理问题是求解有限厚度平行板电容器的拉普拉斯方程，进而得到其电势分布和电荷密度分布。]

## 2. 核心算法

### 2.1 算法思路

[SOR（Successive Over - Relaxation）迭代法是求解拉普拉斯方程的一种迭代算法，其基本思路是在高斯 - 赛德尔迭代的基础上引入松弛因子，以加快收敛速度。以下是实现步骤：
1. 初始化电势网格和导体掩码，设定导体区域的电势值与边界条件（如接地）。
2. 进行迭代更新，对于非导体和边界的内部点，使用SOR更新公式计算新的电势值，该公式结合了旧的电势值和周围点的平均值。
3. 每次迭代计算最大误差，当最大误差小于设定的容差时，认为迭代收敛；若达到最大迭代次数仍未收敛，则发出警告。
4. 最终返回收敛后的电势网格。 ]

### 2.2 关键代码片段

```python
# 请粘贴你认为最重要的核心代码段（如SOR迭代部分）
# SOR 迭代
for iteration in range(max_iter):
    U_old = U.copy()
    max_error = 0.0

    # 更新内部点（不包括导体和边界）
    for i in range(1, ny - 1):
        for j in range(1, nx - 1):
            if not conductor_mask[i, j]:  # 跳过导体点
                # SOR 更新公式
                U_new = 0.25 * (U[i + 1, j] + U[i - 1, j] +
                                U[i, j + 1] + U[i, j - 1])
                U[i, j] = (1 - omega) * U[i, j] + omega * U_new

                # 跟踪最大误差
                error = abs(U[i, j] - U_old[i, j])
                max_error = max(max_error, error)

    # 检查收敛性
    if max_error < tolerance:
        print(f"经过 {iteration + 1} 次迭代后收敛")
        break
else:
    print(f"警告: 达到最大迭代次数 ({max_iter})")
```

## 3. 实验结果

### 3.1 主要输出

[![QQ_1750217309564](https://github.com/user-attachments/assets/009fe1d7-482a-4784-9b8a-112376d3ac89)
请描述你的程序输出的关键数值结果，如收敛迭代次数、电势范围、电荷分布特征等]

### 3.2 结果验证

[1. 单元测试
单元测试是对软件中的最小可测试单元进行检查和验证，通常使用测试框架来编写和运行测试用例。
```python
# 请粘贴你认为最重要的核心代码段（如SOR迭代部分）
import unittest

def add(a, b):
    return a + b

class TestAdd(unittest.TestCase):
    def test_add(self):
        result = add(2, 3)
        self.assertEqual(result, 5)

if __name__ == '__main__':
    unittest.main()
```
2. 边界条件检查
边界条件是指输入数据的边界值，如最小值、最大值、空值等。验证边界条件可以确保程序在极端情况下仍然能够正常工作。
```python
def get_element_at_index(lst, index):
    if index < 0 or index >= len(lst):
        return None
    return lst[index]

# 测试边界条件
lst = [1, 2, 3]
print(get_element_at_index(lst, 0))  # 正常情况
print(get_element_at_index(lst, 2))  # 最大索引
print(get_element_at_index(lst, 3))  # 越界索引
```
3. 物理合理性分析
如果程序处理的是与物理世界相关的数据，那么结果应该符合物理规律。例如，计算物体的速度、加速度等，结果应该在合理的范围内
```python
def free_fall_velocity(time):
    g = 9.8  # 重力加速度
    if time < 0:
        return 0
    return g * time

# 验证物理合理性
time = 2
velocity = free_fall_velocity(time)
if velocity < 0:
    print("结果不符合物理规律")
else:
    print(f"物体在 {time} 秒后的速度为 {velocity} m/s")
```]

## 4. 问题与收获

### 4.1 主要问题

[在实现有限厚度平行板电容器求解程序的过程中，可能会遇到以下主要困难或问题：

### 1. 数值方法的收敛性问题
- **具体表现**：在使用高斯 - 赛德尔超松弛（SOR）方法求解二维拉普拉斯方程时，收敛速度和收敛性是关键问题。松弛因子 `omega` 的选择会显著影响收敛速度，当 `omega` 取值不合适时，可能导致迭代过程收敛缓慢甚至不收敛。如果 `omega` 接近 2，虽然理论上可以加快收敛速度，但实际中可能会导致数值不稳定，使得误差不断增大，无法达到收敛条件。
- **代码体现**：在 `solve_laplace_sor` 函数中，设置了最大迭代次数 `max_iter` 和收敛容差 `tolerance`。当达到最大迭代次数时，程序会输出警告信息，提示未达到收敛条件。
```python
for iteration in range(max_iter):
    U_old = U.copy()
    max_error = 0.0
    # ...
    if max_error < tolerance:
        print(f"经过 {iteration + 1} 次迭代后收敛")
        break
else:
    print(f"警告: 达到最大迭代次数 ({max_iter})")
```
- **解决办法**：需要通过试验不同的 `omega` 值，找到一个合适的松弛因子，以平衡收敛速度和稳定性。通常，`omega` 的取值范围在 1.0 到 2.0 之间，可以通过多次测试和经验来确定最佳值。

### 2. 边界条件和导体区域的处理
- **具体表现**：正确设置边界条件和定义导体区域是求解拉普拉斯方程的关键。在有限厚度平行板电容器问题中，需要准确地定义上、下极板的位置和电势，同时还要考虑接地边界条件。如果边界条件设置错误，会导致电势分布不符合物理实际，进而影响电荷密度的计算结果。
- **代码体现**：在 `solve_laplace_sor` 函数中，通过 `conductor_mask` 布尔数组来标记导体区域，并为导体区域和边界区域设置相应的电势值。
```python
# 定义导体区域
# 上极板: +100V
conductor_left = nx // 4
conductor_right = nx // 4 * 3
y_upper_start = ny // 2 + plate_separation // 2
y_upper_end = y_upper_start + plate_thickness
conductor_mask[y_upper_start:y_upper_end,
               conductor_left:conductor_right] = True
U[y_upper_start:y_upper_end, conductor_left:conductor_right] = 100.0

# 下极板: -100V
y_lower_end = ny // 2 - plate_separation // 2
y_lower_start = y_lower_end - plate_thickness
conductor_mask[y_lower_start:y_lower_end,
               conductor_left:conductor_right] = True
U[y_lower_start:y_lower_end, conductor_left:conductor_right] = -100.0

# 边界条件: 接地边界
U[:, 0] = 0.0
U[:, -1] = 0.0
U[0, :] = 0.0
U[-1, :] = 0.0
```
- **解决办法**：在编写代码时，需要仔细考虑物理模型，确保边界条件和导体区域的定义准确无误。可以通过可视化结果和物理常识来验证设置的正确性。]

### 4.2 解决方法

[### 1. 数值方法的收敛性问题

#### 调试方法
- **日志输出**：在 `solve_laplace_sor` 函数中添加了迭代次数和误差的输出信息。每次迭代后，计算当前迭代的最大误差 `max_error`，并与收敛容差 `tolerance` 进行比较。当 `max_error` 小于 `tolerance` 时，输出收敛信息和迭代次数；当达到最大迭代次数 `max_iter` 仍未收敛时，输出警告信息。
```python
for iteration in range(max_iter):
    U_old = U.copy()
    max_error = 0.0
    # ...
    if max_error < tolerance:
        print(f"经过 {iteration + 1} 次迭代后收敛")
        break
else:
    print(f"警告: 达到最大迭代次数 ({max_iter})")
```
- **参数调整试验**：通过手动修改松弛因子 `omega` 的值，观察不同 `omega` 下迭代收敛的速度和稳定性。在代码中，初始设置 `omega = 1.9`，可以尝试不同的值，如 1.2、1.5、1.8 等，记录每次试验的迭代次数和收敛情况。

#### 解决思路
- **理论依据**：高斯 - 赛德尔超松弛（SOR）方法的收敛速度与松弛因子 `omega` 密切相关。理论上，当 `omega` 取值在 1.0 到 2.0 之间时，方法收敛，且越接近 2 收敛速度越快，但也越容易出现数值不稳定的情况。
- **经验选择**：通过多次试验不同的 `omega` 值，观察迭代次数和误差变化，找到一个在收敛速度和稳定性之间取得平衡的值。例如，在这个程序中，`omega = 1.9` 是一个经过试验后选择的相对合适的值，既能保证较快的收敛速度，又能避免数值不稳定。

### 2. 边界条件和导体区域的处理

#### 调试方法
- **可视化验证**：在代码中添加可视化部分，将电势分布和导体区域可视化。使用 `matplotlib` 库绘制电势的 3D 可视化图和电荷密度的 3D 分布图，通过观察图形来检查边界条件和导体区域的设置是否正确。
```python
def plot_results(potential, charge_density, x_coords, y_coords):
    X, Y = np.meshgrid(x_coords, y_coords)
    fig = plt.figure(figsize=(15, 6))
    # 子图 1: 电势的 3D 可视化
    ax1 = fig.add_subplot(121, projection='3d')
    ax1.plot_wireframe(X, Y, potential, rstride=3, cstride=3, color='r')
    levels = np.linspace(potential.min(), potential.max(), 20)
    ax1.contour(X, Y, potential, zdir='z', offset=potential.min(), levels=levels)
    ax1.set_title('电势的 3D 可视化')
    # ...
    plt.tight_layout()
    plt.show()
```
- **打印中间结果**：在代码中打印导体区域的坐标和电势值，检查是否符合预期。例如，在设置上、下极板的电势时，可以添加打印语句：
```python
# 上极板: +100V
conductor_left = nx // 4
conductor_right = nx // 4 * 3
y_upper_start = ny // 2 + plate_separation // 2
y_upper_end = y_upper_start + plate_thickness
conductor_mask[y_upper_start:y_upper_end, conductor_left:conductor_right] = True
U[y_upper_start:y_upper_end, conductor_left:conductor_right] = 100.0
print(f"上极板区域: ({y_upper_start}, {y_upper_end}), ({conductor_left}, {conductor_right})，电势: {U[y_upper_start, conductor_left]} V")
```

#### 解决思路
- **物理模型分析**：仔细分析有限厚度平行板电容器的物理模型，明确上、下极板的位置和电势，以及接地边界条件。根据物理原理，上极板电势为 +100V，下极板电势为 -100V，边界处电势为 0V。
- **代码实现检查**：在代码中，使用布尔数组 `conductor_mask` 标记导体区域，并为导体区域和边界区域设置相应的电势值。通过检查代码逻辑，确保边界条件和导体区域的定义准确无误。同时，结合可视化结果和打印的中间结果，验证设置的正确性。]

### 4.3 主要收获

[请用3-5句话总结通过本实验学到的知识和技能
通过这个实验，我们可以总结出以下知识和技能：
1. 掌握了使用高斯 - 赛德尔超松弛（SOR）方法求解二维拉普拉斯方程，能够解决有限厚度平行板电容器的电势分布问题，同时了解了松弛因子对迭代收敛速度和稳定性的影响。
2. 学会根据物理模型准确设置边界条件和导体区域，确保计算结果符合物理实际。
3. 利用 `scipy.ndimage.laplace` 计算拉普拉斯算子，进而根据泊松方程计算电荷密度分布。
4. 掌握了使用 `matplotlib` 库进行 3D 可视化的方法，能直观展示电势和电荷密度的分布。
5. 学会了对计算结果进行统计分析，如计算电势和电荷密度的最值、范围以及总电荷等，以验证结果的合理性。 ]

## 5. 思考题（可选）

### 5.1 松弛因子影响分析

[请分析不同松弛因子ω对收敛速度的影响，并解释原因
不同松弛因子ω对收敛速度影响显著，具体分析及原因如下：
1. **ω在1 - 2之间**：当ω取值于1.0到2.0时，收敛速度比高斯 - 赛德尔方法（ω = 1）快。原因是SOR方法通过引入ω对更新值加权平均，适当增大ω使新值中相邻网格点贡献更大，能更快传播信息，减少迭代次数，加快收敛。例如代码里设置ω = 1.9时，迭代次数会明显减少。
2. **ω接近1**：收敛速度与高斯 - 赛德尔方法相近，收敛变慢。因为此时SOR方法近似退化为高斯 - 赛德尔方法，更新机制变化不大，信息传播速度未得到有效提升。
3. **ω ≥ 2**：方法不稳定甚至不收敛。由于更新步长过大，每次迭代的变化幅度过大，导致迭代过程难以收敛到真实解，程序可能达到最大迭代次数仍未收敛。 ]

### 5.2 有限厚度效应

[请对比分析有限厚度与理想薄板电容器在电场分布上的差异
### 有限厚度与理想薄板电容器电场分布差异对比分析

#### 1. 极板内部电场
 - **理想薄板电容器**：在理想模型里，极板被视为无限薄，不考虑其厚度。因此极板内部不存在电场，电场只存在于极板之间的空间，且极板间电场是均匀分布的，电场线垂直于极板，从正极板指向负极板。
 - **有限厚度电容器**：由于极板具有一定厚度，在极板内部会存在电场。当电容器充电后，电荷会在极板厚度方向上有一定分布，导致极板内部不同位置的电场并不为零。而且在极板靠近边缘的区域，电场分布会更为复杂，会受到边缘效应的影响。

#### 2. 边缘电场
 - **理想薄板电容器**：其模型假设极板为无限大，不考虑边缘效应。所以在极板边缘处，电场依然保持均匀分布，电场线是垂直于极板的平行线，电场强度在整个极板间区域恒定。
 - **有限厚度电容器**：边缘效应显著。在极板边缘，电场线不再是垂直于极板的直线，而是会向外弯曲。这是因为电荷分布在有限大小的极板上，边缘处的电荷分布不均匀，导致电场分布也不均匀。在极板边缘外侧，也会存在一定的电场，使得电场分布范围超出了极板之间的区域。

#### 3. 电势分布
 - **理想薄板电容器**：极板间电势呈线性变化，从正极板的高电势线性降低到负极板的低电势。等势面是平行于极板的平面。
 - **有限厚度电容器**：由于极板内部有电场以及边缘效应的存在，电势分布更为复杂。在极板内部，电势会随着位置变化而改变；在边缘区域，等势面不再是规则的平行平面，会发生扭曲变形。

#### 4. 代码体现与差异根源
 - 在提供的代码中，通过设置 `plate_thickness` 参数来模拟有限厚度的极板。代码求解的是有限厚度平行板电容器的拉普拉斯方程，得到的电势和电荷密度分布反映了有限厚度电容器的电场特性。而理想薄板电容器模型中，由于不考虑极板厚度，其电场和电势分布的计算方法会更为简化，不需要考虑极板内部的电场和复杂的边缘效应。 ]

### 5.3 数值精度讨论

[请讨论网格分辨率对计算精度的影响，以及如何平衡精度与计算效率
### 网格分辨率对计算精度的影响
网格分辨率在有限厚度平行板电容器的电场计算中，对计算精度有着显著影响。
- **高分辨率提升精度**：当网格分辨率提高，也就是 `nx` 和 `ny`（x 和 y 方向的网格点数）增大时，网格间距 `dx` 和 `dy` 会减小。这意味着在模拟中能够更精细地描述物理区域，捕捉到更多的细节信息。例如，在计算电势和电荷密度分布时，高分辨率的网格可以更准确地模拟极板边缘的电场变化，使得电场分布的计算结果更接近真实情况。在代码里，更多的网格点能更精确地表示极板的厚度和间距，以及极板内部和周围的电场分布。
- **低分辨率降低精度**：相反，若网格分辨率较低，网格间距较大，物理区域的细节就会被忽略。这会导致电场分布的计算出现偏差，尤其是在极板边缘等电场变化剧烈的区域。例如，低分辨率下可能无法准确模拟出边缘效应，使得电场分布的计算结果与实际情况存在较大差异。

### 平衡精度与计算效率的方法
在实际计算中，需要平衡计算精度和计算效率，可采用以下方法：
- **合理选择初始分辨率**：根据问题的具体要求和特点，选择一个合适的初始网格分辨率。对于一些对精度要求不高的初步模拟，可以使用较低的分辨率，以快速得到一个大致的结果。在代码中，可以先设置较小的 `nx` 和 `ny` 进行测试。例如，当只需要对电容器的整体电场分布有一个初步了解时，使用较小的网格点数可以减少计算时间。
- **逐步细化网格**：在初步模拟的基础上，逐步增加网格分辨率，观察计算结果的变化。如果随着分辨率的提高，计算结果的变化较小，说明已经达到了一个合适的精度；如果变化较大，则需要继续提高分辨率。这种方法可以在保证一定精度的前提下，避免不必要的高分辨率计算，提高计算效率。
- **优化算法**：采用高效的算法也可以提高计算效率。在代码中，使用了高斯 - 赛德尔超松弛（SOR）方法求解拉普拉斯方程，该方法通过引入松弛因子 `omega` 可以加快收敛速度，减少迭代次数，从而提高计算效率。合理选择松弛因子也能在一定程度上平衡精度和效率。例如，选择合适的 `omega` 值可以使迭代更快收敛，同时保证计算精度。 ]
