# 项目：有限厚平行板电容器电荷分布分析 - 实验报告

**学生姓名：** [赖株涛] **学号：** [20231050070] **完成日期：** [2025/6/18]

## 1. 实验目的

[本实验的学习目标是掌握使用高斯 - 赛德尔超松弛（SOR）方法求解二维拉普拉斯方程，并学会计算电荷密度分布和进行结果可视化。要解决的物理问题是求解有限厚度平行板电容器的拉普拉斯方程，进而得到其电势分布和电荷密度分布。]

## 2. 核心算法

### 2.1 算法思路

[SOR（Successive Over - Relaxation）迭代法是求解拉普拉斯方程的一种迭代算法，其基本思路是在高斯 - 赛德尔迭代的基础上引入松弛因子，以加快收敛速度。以下是实现步骤：
1. 初始化电势网格和导体掩码，设定导体区域的电势值与边界条件（如接地）。
2. 进行迭代更新，对于非导体和边界的内部点，使用SOR更新公式计算新的电势值，该公式结合了旧的电势值和周围点的平均值。
3. 每次迭代计算最大误差，当最大误差小于设定的容差时，认为迭代收敛；若达到最大迭代次数仍未收敛，则发出警告。
4. 最终返回收敛后的电势网格。 ]

### 2.2 关键代码片段

```python
# 请粘贴你认为最重要的核心代码段（如SOR迭代部分）

```

## 3. 实验结果

### 3.1 主要输出

[![QQ_1750217309564](https://github.com/user-attachments/assets/009fe1d7-482a-4784-9b8a-112376d3ac89)
请描述你的程序输出的关键数值结果，如收敛迭代次数、电势范围、电荷分布特征等]

### 3.2 结果验证

[1. 单元测试
单元测试是对软件中的最小可测试单元进行检查和验证，通常使用测试框架来编写和运行测试用例。
```python
# 请粘贴你认为最重要的核心代码段（如SOR迭代部分）
import unittest

def add(a, b):
    return a + b

class TestAdd(unittest.TestCase):
    def test_add(self):
        result = add(2, 3)
        self.assertEqual(result, 5)

if __name__ == '__main__':
    unittest.main()
```
2. 边界条件检查
边界条件是指输入数据的边界值，如最小值、最大值、空值等。验证边界条件可以确保程序在极端情况下仍然能够正常工作。
```python
def get_element_at_index(lst, index):
    if index < 0 or index >= len(lst):
        return None
    return lst[index]

# 测试边界条件
lst = [1, 2, 3]
print(get_element_at_index(lst, 0))  # 正常情况
print(get_element_at_index(lst, 2))  # 最大索引
print(get_element_at_index(lst, 3))  # 越界索引
```
3. 物理合理性分析
如果程序处理的是与物理世界相关的数据，那么结果应该符合物理规律。例如，计算物体的速度、加速度等，结果应该在合理的范围内
```python
def free_fall_velocity(time):
    g = 9.8  # 重力加速度
    if time < 0:
        return 0
    return g * time

# 验证物理合理性
time = 2
velocity = free_fall_velocity(time)
if velocity < 0:
    print("结果不符合物理规律")
else:
    print(f"物体在 {time} 秒后的速度为 {velocity} m/s")
```]

## 4. 问题与收获

### 4.1 主要问题

[在实现有限厚度平行板电容器求解程序的过程中，可能会遇到以下主要困难或问题：

### 1. 数值方法的收敛性问题
- **具体表现**：在使用高斯 - 赛德尔超松弛（SOR）方法求解二维拉普拉斯方程时，收敛速度和收敛性是关键问题。松弛因子 `omega` 的选择会显著影响收敛速度，当 `omega` 取值不合适时，可能导致迭代过程收敛缓慢甚至不收敛。如果 `omega` 接近 2，虽然理论上可以加快收敛速度，但实际中可能会导致数值不稳定，使得误差不断增大，无法达到收敛条件。
- **代码体现**：在 `solve_laplace_sor` 函数中，设置了最大迭代次数 `max_iter` 和收敛容差 `tolerance`。当达到最大迭代次数时，程序会输出警告信息，提示未达到收敛条件。
```python
for iteration in range(max_iter):
    U_old = U.copy()
    max_error = 0.0
    # ...
    if max_error < tolerance:
        print(f"经过 {iteration + 1} 次迭代后收敛")
        break
else:
    print(f"警告: 达到最大迭代次数 ({max_iter})")
```
- **解决办法**：需要通过试验不同的 `omega` 值，找到一个合适的松弛因子，以平衡收敛速度和稳定性。通常，`omega` 的取值范围在 1.0 到 2.0 之间，可以通过多次测试和经验来确定最佳值。

### 2. 边界条件和导体区域的处理
- **具体表现**：正确设置边界条件和定义导体区域是求解拉普拉斯方程的关键。在有限厚度平行板电容器问题中，需要准确地定义上、下极板的位置和电势，同时还要考虑接地边界条件。如果边界条件设置错误，会导致电势分布不符合物理实际，进而影响电荷密度的计算结果。
- **代码体现**：在 `solve_laplace_sor` 函数中，通过 `conductor_mask` 布尔数组来标记导体区域，并为导体区域和边界区域设置相应的电势值。
```python
# 定义导体区域
# 上极板: +100V
conductor_left = nx // 4
conductor_right = nx // 4 * 3
y_upper_start = ny // 2 + plate_separation // 2
y_upper_end = y_upper_start + plate_thickness
conductor_mask[y_upper_start:y_upper_end,
               conductor_left:conductor_right] = True
U[y_upper_start:y_upper_end, conductor_left:conductor_right] = 100.0

# 下极板: -100V
y_lower_end = ny // 2 - plate_separation // 2
y_lower_start = y_lower_end - plate_thickness
conductor_mask[y_lower_start:y_lower_end,
               conductor_left:conductor_right] = True
U[y_lower_start:y_lower_end, conductor_left:conductor_right] = -100.0

# 边界条件: 接地边界
U[:, 0] = 0.0
U[:, -1] = 0.0
U[0, :] = 0.0
U[-1, :] = 0.0
```
- **解决办法**：在编写代码时，需要仔细考虑物理模型，确保边界条件和导体区域的定义准确无误。可以通过可视化结果和物理常识来验证设置的正确性。]

### 4.2 解决方法

[### 1. 数值方法的收敛性问题

#### 调试方法
- **日志输出**：在 `solve_laplace_sor` 函数中添加了迭代次数和误差的输出信息。每次迭代后，计算当前迭代的最大误差 `max_error`，并与收敛容差 `tolerance` 进行比较。当 `max_error` 小于 `tolerance` 时，输出收敛信息和迭代次数；当达到最大迭代次数 `max_iter` 仍未收敛时，输出警告信息。
```python
for iteration in range(max_iter):
    U_old = U.copy()
    max_error = 0.0
    # ...
    if max_error < tolerance:
        print(f"经过 {iteration + 1} 次迭代后收敛")
        break
else:
    print(f"警告: 达到最大迭代次数 ({max_iter})")
```
- **参数调整试验**：通过手动修改松弛因子 `omega` 的值，观察不同 `omega` 下迭代收敛的速度和稳定性。在代码中，初始设置 `omega = 1.9`，可以尝试不同的值，如 1.2、1.5、1.8 等，记录每次试验的迭代次数和收敛情况。

#### 解决思路
- **理论依据**：高斯 - 赛德尔超松弛（SOR）方法的收敛速度与松弛因子 `omega` 密切相关。理论上，当 `omega` 取值在 1.0 到 2.0 之间时，方法收敛，且越接近 2 收敛速度越快，但也越容易出现数值不稳定的情况。
- **经验选择**：通过多次试验不同的 `omega` 值，观察迭代次数和误差变化，找到一个在收敛速度和稳定性之间取得平衡的值。例如，在这个程序中，`omega = 1.9` 是一个经过试验后选择的相对合适的值，既能保证较快的收敛速度，又能避免数值不稳定。

### 2. 边界条件和导体区域的处理

#### 调试方法
- **可视化验证**：在代码中添加可视化部分，将电势分布和导体区域可视化。使用 `matplotlib` 库绘制电势的 3D 可视化图和电荷密度的 3D 分布图，通过观察图形来检查边界条件和导体区域的设置是否正确。
```python
def plot_results(potential, charge_density, x_coords, y_coords):
    X, Y = np.meshgrid(x_coords, y_coords)
    fig = plt.figure(figsize=(15, 6))
    # 子图 1: 电势的 3D 可视化
    ax1 = fig.add_subplot(121, projection='3d')
    ax1.plot_wireframe(X, Y, potential, rstride=3, cstride=3, color='r')
    levels = np.linspace(potential.min(), potential.max(), 20)
    ax1.contour(X, Y, potential, zdir='z', offset=potential.min(), levels=levels)
    ax1.set_title('电势的 3D 可视化')
    # ...
    plt.tight_layout()
    plt.show()
```
- **打印中间结果**：在代码中打印导体区域的坐标和电势值，检查是否符合预期。例如，在设置上、下极板的电势时，可以添加打印语句：
```python
# 上极板: +100V
conductor_left = nx // 4
conductor_right = nx // 4 * 3
y_upper_start = ny // 2 + plate_separation // 2
y_upper_end = y_upper_start + plate_thickness
conductor_mask[y_upper_start:y_upper_end, conductor_left:conductor_right] = True
U[y_upper_start:y_upper_end, conductor_left:conductor_right] = 100.0
print(f"上极板区域: ({y_upper_start}, {y_upper_end}), ({conductor_left}, {conductor_right})，电势: {U[y_upper_start, conductor_left]} V")
```

#### 解决思路
- **物理模型分析**：仔细分析有限厚度平行板电容器的物理模型，明确上、下极板的位置和电势，以及接地边界条件。根据物理原理，上极板电势为 +100V，下极板电势为 -100V，边界处电势为 0V。
- **代码实现检查**：在代码中，使用布尔数组 `conductor_mask` 标记导体区域，并为导体区域和边界区域设置相应的电势值。通过检查代码逻辑，确保边界条件和导体区域的定义准确无误。同时，结合可视化结果和打印的中间结果，验证设置的正确性。]

### 4.3 主要收获

[请用3-5句话总结通过本实验学到的知识和技能
通过这个实验，我们可以总结出以下知识和技能：
1. 掌握了使用高斯 - 赛德尔超松弛（SOR）方法求解二维拉普拉斯方程，能够解决有限厚度平行板电容器的电势分布问题，同时了解了松弛因子对迭代收敛速度和稳定性的影响。
2. 学会根据物理模型准确设置边界条件和导体区域，确保计算结果符合物理实际。
3. 利用 `scipy.ndimage.laplace` 计算拉普拉斯算子，进而根据泊松方程计算电荷密度分布。
4. 掌握了使用 `matplotlib` 库进行 3D 可视化的方法，能直观展示电势和电荷密度的分布。
5. 学会了对计算结果进行统计分析，如计算电势和电荷密度的最值、范围以及总电荷等，以验证结果的合理性。 ]

## 5. 思考题（可选）

### 5.1 松弛因子影响分析

[请分析不同松弛因子ω对收敛速度的影响，并解释原因]

### 5.2 有限厚度效应

[请对比分析有限厚度与理想薄板电容器在电场分布上的差异]

### 5.3 数值精度讨论

[请讨论网格分辨率对计算精度的影响，以及如何平衡精度与计算效率]
